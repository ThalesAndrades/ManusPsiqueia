---
name: ğŸ”§ Code Quality

on:
  push:
    branches: [master, develop]
  pull_request:
    branches: [master, develop]
  workflow_dispatch:

jobs:
  swift-lint:
    name: ğŸ” SwiftLint Analysis
    runs-on: macos-14
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
      
      - name: ğŸ”§ Install SwiftLint
        run: |
          brew install swiftlint
          swiftlint version
      
      - name: ğŸ” Run SwiftLint
        run: |
          swiftlint lint --reporter github-actions-logging
          swiftlint lint --reporter json > swiftlint-results.json
        continue-on-error: true
      
      - name: ğŸ“¤ Upload SwiftLint Results
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: swiftlint-results
          path: swiftlint-results.json

  code-formatting:
    name: ğŸ§¹ Code Formatting Check
    runs-on: macos-14
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
      
      - name: ğŸ“Š Code Metrics
        run: |
          echo "ğŸ“Š Analyzing code metrics..."
          
          # Count Swift files
          swift_files=$(find . -name "*.swift" -not -path "./.git/*" | wc -l)
          echo "Swift files: $swift_files"
          
          # Count total lines
          total_lines=$(find . -name "*.swift" -not -path "./.git/*" | xargs wc -l | tail -1 | awk '{print $1}')
          echo "Total lines of code: $total_lines"
          
          # Find large files
          echo "Files with >300 lines:"
          find . -name "*.swift" -not -path "./.git/*" -exec wc -l {} + | sort -nr | head -5
          
          echo "âœ… Code metrics analysis completed"

  documentation-check:
    name: ğŸ“ Documentation Check
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
      
      - name: ğŸ“ Check Documentation
        run: |
          echo "ğŸ“ Checking project documentation..."
          
          # Check for required documentation files
          docs_score=0
          total_docs=5
          
          [ -f "README.md" ] && docs_score=$((docs_score + 1)) && echo "âœ… README.md found"
          [ -f "CONTRIBUTING.md" ] && docs_score=$((docs_score + 1)) && echo "âœ… CONTRIBUTING.md found"
          [ -f "CHANGELOG.md" ] && docs_score=$((docs_score + 1)) && echo "âœ… CHANGELOG.md found"
          [ -f "LICENSE" ] && docs_score=$((docs_score + 1)) && echo "âœ… LICENSE found"
          [ -d "docs" ] && docs_score=$((docs_score + 1)) && echo "âœ… docs/ directory found"
          
          percentage=$((docs_score * 100 / total_docs))
          echo "ğŸ“Š Documentation score: $docs_score/$total_docs ($percentage%)"
          
          if [ $percentage -ge 80 ]; then
            echo "âœ… Documentation is well maintained"
          else
            echo "âš ï¸ Documentation needs improvement"
          fi